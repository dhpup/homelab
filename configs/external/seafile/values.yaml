image:
  # Use public/community image to avoid private registry requirements in local k3d
  repository: linuxserver/seafile
  tag: latest
  pullPolicy: IfNotPresent

imagePullSecrets: []

env:
  SEAFILE_ADMIN_EMAIL: noah@homelab.local
  SEAFILE_SERVER_HOSTNAME: seafile.homelab.local
  SEAFILE_ADMIN_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: seafile-sealed-secret
        key: SEAFILE_ADMIN_PASSWORD
  DB_ROOT_PASSWD:
    valueFrom:
      secretKeyRef:
        name: seafile-sealed-secret
        key: DB_ROOT_PASSWD

ingress:
  main:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
      cert-manager.io/cluster-issuer: selfsigned
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/proxy-body-size: 1024m
  # external-dns annotations removed (not using ExternalDNS)

    hosts:
      - host: seafile.homelab.local
        paths:
        - path: /
          pathType: Prefix
    tls:
    - secretName: seafile.homelab.local
      hosts:
      - seafile.homelab.local
  sso:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/permanent-redirect: "https://seafile.homelab.local/sso/?next=/"
    hosts:
      - host: seafile.homelab.local
        paths:
        - path: /accounts/login/
          pathType: Prefix
    tls:
    - secretName: seafile.homelab.local
      hosts:
      - seafile.homelab.local

persistence:
  shared:
    enabled: true
    nameOverride: local-path-rwo
    type: pvc
    storageClass: local-path
    accessMode: ReadWriteOnce
    size: 1Ti

mariadb:
  enabled: true
  architecture: standalone
  auth:
    database: seafile
    username: seafile
    existingSecret: seafile-sealed-secret
  primary:
    persistence:
      enabled: true
      storageClass: local-path
      size: 25Gi
    image:
      repository: docker.io/bitnami/mariadb
      tag: 10.5.8-debian-10-r0
      pullPolicy: IfNotPresent
  memcached:
    image:
      repository: docker.io/bitnami/memcached
      tag: 1.6.14-debian-10-r0
      pullPolicy: IfNotPresent